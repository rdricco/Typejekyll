!function(a){a.fn.extend({BlackAndWhite:function(b){"use strict";var c=this,d=a.extend({hoverEffect:!0,webworkerPath:!1,invertHoverEffect:!1,speed:500,onImageReady:null,intensity:1,crossOrigin:!0},b),e=d.hoverEffect,f=d.webworkerPath,g=d.invertHoverEffect,h="number"==typeof d.intensity&&d.intensity<1&&d.intensity>0?d.intensity:1,i=a.isPlainObject(d.speed)?d.speed.fadeIn:d.speed,j=a.isPlainObject(d.speed)?d.speed.fadeOut:d.speed,k=a(window),l=".BlackAndWhite",n=(!(!document.all||window.opera||!window.XMLHttpRequest)," -webkit- -moz- -o- -ms- ".split(" ")),o={},p=function(a){if(o[a]||""===o[a])return o[a]+a;var b=document.createElement("div"),c=["","Moz","Webkit","O","ms","Khtml"];for(var d in c)if("undefined"!=typeof b.style[c[d]+a])return o[a]=c[d],c[d]+a;return a.toLowerCase()},q=function(){var a=document.createElement("div");return a.style.cssText=n.join("filter:blur(2px); "),!!a.style.length&&(void 0===document.documentMode||document.documentMode>9)}(),r=!!document.createElement("canvas").getContext,s=function(){return"undefined"!=typeof Worker}(),t=p("Filter"),u=[],v=!(!s||!f)&&new Worker(f+"BnWWorker.js"),w=function(b){a(b.currentTarget).find(".BWfade").stop(!0,!0).animate({opacity:g?0:1},j)},x=function(b){a(b.currentTarget).find(".BWfade").stop(!0,!0).animate({opacity:g?1:0},i)},y=function(a){"function"==typeof d.onImageReady&&d.onImageReady(a)},z=function(a){v&&r&&!q&&!a&&A()},A=function(){return u.length?(v.postMessage({imgData:u[0].imageData,intensity:h}),void(v.onmessage=function(a){u[0].ctx.putImageData(a.data,0,0),y(u[0].img),u.splice(0,1),A()})):(v.terminate&&v.terminate(),void(v.close&&v.close()))},B=function(a){return a.complete||"undefined"!=typeof a.naturalWidth&&a.naturalWidth},C=function(a,b,c,d){var e=b.getContext("2d"),g=0;e.drawImage(a,0,0,c,d);var j=e.getImageData(0,0,c,d),k=j.data,l=k.length;if(v)u.push({imageData:j,ctx:e,img:a});else{for(;g<l;g+=4){var m=.3*k[g]+.59*k[g+1]+.11*k[g+2];k[g]=~~(m*h+k[g]*(1-h)),k[g+1]=~~(m*h+k[g+1]*(1-h)),k[g+2]=~~(m*h+k[g+2]*(1-h))}e.putImageData(j,0,0),y(a)}},D=function(b,c){var k,e=b[0],i=(e.src,b.position()),j={top:i.top,left:i.left,position:"absolute","-webkit-transform":"translate3d(0,0,0)",opacity:g?0:1};d.crossOrigin&&(e.crossOrigin="anonymous"),r&&!q?(k=a('<canvas width="'+e.naturalWidth+'" height="'+e.naturalHeight+'" class="BWfade"></canvas>'),j.width=b.width(),j.height=b.height(),C(e,k.get(0),e.naturalWidth,e.naturalHeight)):(r?j[t]="grayscale("+100*h+"%)":j.filter="progid:DXImageTransform.Microsoft.BasicImage(grayscale=1)",k=b.clone().addClass("BWFilter BWfade"),y(e)),k.css(j).prependTo(c),!a.support.opacity&&g&&k.animate({opacity:0},0)},E=function(){c.each(function(b,c){var d=a(c).find("img"),e=a(d).width(),f=a(d).height();a(this).find("canvas").css({width:e,height:f})})},F=function(){var b=c.find("img").filter(function(){return!a(this).data("_b&w")}).length;c.each(function(c,d){var e=a(d),f=e.find("img");f.data("_b&w")||(B(f[0])?(b--,D(f,e)):f.on("load",function(){return f.data("_b&w_loaded")||!f[0].complete?void setTimeout(function(){f.load()},20):(D(f,e),f.data("_b&w_loaded",!0),b--,void z(b))}).load(),f.data("_b&w",!0))}),z(b),e&&c.unbind(l).on("mouseleave"+l,w).on("mouseenter"+l,x),r&&!q&&k.unbind(l).on("resize"+l+" orientationchange"+l,E)},G=function(){c.off(l),k.off(l)};return F(),{destroy:G}}})}(jQuery);
